using Printf

open("../primes_1e7.txt") do file
    global primes;
    primes = map(x-> parse(Int32, x), split(read(file, String), ','))

end

function factors(n)
    res = Array{Int64}[];

    for p in primes
        if (p>n)
            break;
        end
        if (n % p == 0)
            push!(res, [p,0]);
        end
        while (n % p == 0)
            res[end][2] += 1;
            n /= p;
        end
    end
    return res
end

function solutions(n)
    facs = factors(n);
    res = 0;

    x = [0 for _ in 1:length(facs)]
    done = false;
    while !done
        p = prod(map(k -> k[1]^k[2], zip(map(k->k[1], facs), x)));

        if p <= n
            res += 1;
        end
        for i in 1:length(facs)
            if (x[i] == facs[i][2]*2)
                x[i] = 0;
                if (i == length(facs))
                    done = true;
                end
            else
                x[i] += 1;
                break;
            end
        end
    end

    return res
end


function printFacs(facs)
    str = "{"
    for x in facs
        str = string(str, x[1], ": ", x[2], ", ");
    end
    return string(str, "}")

end
function main()
    i = 2;
    m = 0;
    δ = 2;
    while true
        sols = solutions(i)
        if (sols > m)
            facs = map(x->x[1], factors(i))
            δ = max(prod(view(facs, 1:length(facs)-1)), δ)
            @printf("%6d %4d,  %s\n", i, sols, printFacs(factors(i)))
            m = sols;
        end
        i += δ;
    end
end

main()


"""
2    2
4    3
6    5
12    8
24   11
30   14
60   23
120   32
180   38
210   41
420   68
840   95
1260  113
1680  122
2520  158
4620  203
9240  284
13860  338
18480  365
27720  473
55440  608
83160  662
110880  743
120120  851
180180 1013
240240 1094
360360 1418
720720 1823
1081080 1985
1441440 2228
1801800 2363
2042040 2552
3063060 3038
4084080 3281
6126120 4253
12252240 5468
18378360 5954
24504480 6683
30630600 7088
36756720 7655
49008960 7898
58198140 9113
77597520 9842
116396280 12758
232792560 16403
349188840 17861
465585120 20048
581981400 21263
698377680 22964
931170240 23693
1163962800 27338
1396755360 28067
1745944200 29768
2327925600 33413
2677114440 38273
4015671660 38274
5354228880 49211
8031343320 53586
10708457760 60150
13385572200 63802
16062686640 68912
21416915520 71105
26771144400 82057
32125373280 84254
40156716600 89379
53542288800 100346
74959204320 100409
77636318760 115000
116454478140 115097
129393864600 115146
155272637520 148046
232908956280 161383
310545275040 181317
388181593800 192477
465817912560 207983
621090550080 214942
776363187600 248229
931635825120 255119
1164544781400 271015
1552726375200 304730
2173816925280 305786
2329089562800 350120
2406725881560 350433
3610088822340 351911
4011209802600 352423
4813451763120 453471
7220177644680 496157
9626903526240 558953
12033629407800 594739
14440355289360 643740
19253807052480 667562
24067258815600 772352
28880710578720 795640
36100888223400 847236
48134517631200 955833
67388324683680 963296
72201776446800 1103324
"""


"""
          2    2,  {2: 1, }
          4    3,  {2: 2, }
          6    5,  {2: 1, 3: 1, }
         12    8,  {2: 2, 3: 1, }
         24   11,  {2: 3, 3: 1, }
         30   14,  {2: 1, 3: 1, 5: 1, }
         60   23,  {2: 2, 3: 1, 5: 1, }
        120   32,  {2: 3, 3: 1, 5: 1, }
        180   38,  {2: 2, 3: 2, 5: 1, }
        210   41,  {2: 1, 3: 1, 5: 1, 7: 1, }
        360   53,  {2: 3, 3: 2, 5: 1, }
        420   68,  {2: 2, 3: 1, 5: 1, 7: 1, }
        840   95,  {2: 3, 3: 1, 5: 1, 7: 1, }
       1260  113,  {2: 2, 3: 2, 5: 1, 7: 1, }
       1680  122,  {2: 4, 3: 1, 5: 1, 7: 1, }
       2520  158,  {2: 3, 3: 2, 5: 1, 7: 1, }
       4620  203,  {2: 2, 3: 1, 5: 1, 7: 1, 11: 1, }
       7560  221,  {2: 3, 3: 3, 5: 1, 7: 1, }
       9240  284,  {2: 3, 3: 1, 5: 1, 7: 1, 11: 1, }
      13860  338,  {2: 2, 3: 2, 5: 1, 7: 1, 11: 1, }
      18480  365,  {2: 4, 3: 1, 5: 1, 7: 1, 11: 1, }
      27720  473,  {2: 3, 3: 2, 5: 1, 7: 1, 11: 1, }
      55440  608,  {2: 4, 3: 2, 5: 1, 7: 1, 11: 1, }
      83160  662,  {2: 3, 3: 3, 5: 1, 7: 1, 11: 1, }
     110880  743,  {2: 5, 3: 2, 5: 1, 7: 1, 11: 1, }
     120120  851,  {2: 3, 3: 1, 5: 1, 7: 1, 11: 1, 13: 1, }
     180180 1013,  {2: 2, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, }
     240240 1094,  {2: 4, 3: 1, 5: 1, 7: 1, 11: 1, 13: 1, }
     360360 1418,  {2: 3, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, }
     720720 1823,  {2: 4, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, }
    1081080 1985,  {2: 3, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, }
    1441440 2228,  {2: 5, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, }
    1801800 2363,  {2: 3, 3: 2, 5: 2, 7: 1, 11: 1, 13: 1, }
    2042040 2552,  {2: 3, 3: 1, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
    2882880 2633,  {2: 6, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, }
    3063060 3038,  {2: 2, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
    4084080 3281,  {2: 4, 3: 1, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
    5405400 3308,  {2: 3, 3: 3, 5: 2, 7: 1, 11: 1, 13: 1, }
    6126120 4253,  {2: 3, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   12252240 5468,  {2: 4, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   18378360 5954,  {2: 3, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   24504480 6683,  {2: 5, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   30630600 7088,  {2: 3, 3: 2, 5: 2, 7: 1, 11: 1, 13: 1, 17: 1, }
   36756720 7655,  {2: 4, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   49008960 7898,  {2: 6, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   58198140 9113,  {2: 2, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
   73513440 9356,  {2: 5, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, }
   77597520 9842,  {2: 4, 3: 1, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
   91891800 9923,  {2: 3, 3: 3, 5: 2, 7: 1, 11: 1, 13: 1, 17: 1, }
 116396280 12758,  {2: 3, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 232792560 16403,  {2: 4, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 349188840 17861,  {2: 3, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 465585120 20048,  {2: 5, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 581981400 21263,  {2: 3, 3: 2, 5: 2, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 698377680 22964,  {2: 4, 3: 3, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 931170240 23693,  {2: 6, 3: 2, 5: 1, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
1163962800 27338,  {2: 4, 3: 2, 5: 2, 7: 1, 11: 1, 13: 1, 17: 1, 19: 1, }
 """
